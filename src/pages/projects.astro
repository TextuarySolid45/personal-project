---
import {marked} from 'marked';
import BaseHead from '../components/BaseHead.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import { SITE_TITLE, SITE_DESCRIPTION } from '../config';

async function getReadMe(name: string){
	const response = await fetch("https://raw.githubusercontent.com/TextuarySolid45/"+name+"/master/README.md");
	const markdown = await response.text();
	return marked.parse(markdown);
}
async function getAllRepos(){
	try{
		const allPublicReposResponse = await fetch("https://api.github.com/users/TextuarySolid45/repos?sort=created&direction=desc");
		const status = allPublicReposResponse.status;
		return status == 200 ? await allPublicReposResponse.json() : null;
	}catch(error){
		return null;
	}
}

const allRepos = await getAllRepos();
var contentList: string[] =[];
if(allRepos != null){
	for(var repo of allRepos){
		const content = await getReadMe(repo.name);
		contentList.push(content);
	}
}
---
<!DOCTYPE html>
<html lang="en">
	<head>
		<BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
		<style>
			ul {
				list-style-type: none;
				padding: unset;
			}
			ul li {
				display: flex;
			}
			ul li time {
				flex: 0 0 130px;
				font-style: italic;
				color: #595959;
			}
			ul li a:visited {
				color: #8e32dc;
			}
	
			hr.rounded {
				border-top: 8px solid #bbb;
				border-radius: 5px;
			}
			article{
				background-color: lightskyblue;
				padding: 2%;
				border-radius: 15px;
			}
		</style>
	</head>
	<body>
		<Header />
		<main >
			<section>
				<ul>
					{
						contentList.length !== 0 ? (contentList.map((value,index,array)=>{
							return <div><article set:html={value}/> <hr> </div>;
						})): (<h1>Encountering API Rate Limit for Github Repos</h1>)
					}
				</ul>
			</section>
		</main>
		<Footer />
	</body>
</html>
